<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>CitySense è¡—é“å¾®è§‚ä½“éªŒé‡‡é›† v2.0</title>
    <style>
        :root {
            --primary: #00E5FF; /* PolyU Cyan */
            --accent: #FF0055; /* Z-score Red */
            --bg: #121212;
            --card-bg: #1E1E1E;
            --text: #E0E0E0;
            --text-dim: #A0A0A0;
            --slider-track: #333;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg);
            color: var(--text);
            margin: 0;
            padding: 15px;
            padding-bottom: 100px;
        }

        h1 { font-size: 1.2rem; color: var(--primary); text-align: center; margin: 10px 0; }
        p.subtitle { text-align: center; font-size: 0.8rem; color: var(--text-dim); margin-bottom: 20px; }

        /* Card Style */
        .card {
            background-color: var(--card-bg);
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 15px;
            border: 1px solid #333;
            position: relative;
        }

        .card-header {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
            border-bottom: 1px solid #333;
            padding-bottom: 8px;
        }

        .icon { font-size: 1.4rem; margin-right: 8px; }
        .card-title { font-weight: bold; font-size: 1rem; color: #fff; }

        /* Photo Upload Styling */
        .photo-upload-box {
            border: 2px dashed #444;
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: border-color 0.3s;
            position: relative;
            overflow: hidden;
        }
        .photo-upload-box:active { border-color: var(--primary); }
        .photo-preview {
            max-width: 100%;
            max-height: 200px;
            display: none;
            margin-top: 10px;
            border-radius: 4px;
        }
        input[type="file"] { display: none; }

        /* Question Group */
        .q-group { margin-bottom: 25px; }
        
        .q-label {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.9rem;
            margin-bottom: 8px;
        }

        .q-tag {
            background: #2a2a2a;
            padding: 2px 6px;
            border-radius: 3px;
            font-size: 0.7rem;
            color: var(--primary);
            margin-left: 5px;
        }

        /* Value Display */
        .val-display {
            font-family: monospace;
            font-size: 1.1rem;
            color: var(--primary);
            font-weight: bold;
            min-width: 30px;
            text-align: right;
        }

        /* Description Box */
        .desc-text {
            font-size: 0.8rem;
            color: #ccc;
            background: #252525;
            padding: 10px;
            border-radius: 6px;
            margin-top: 5px;
            line-height: 1.4;
            border-left: 3px solid #444;
            transition: all 0.2s;
        }
        .desc-text.highlight { border-left-color: var(--primary); background: #2a2a2a; }

        /* Slider Styling */
        input[type=range] {
            -webkit-appearance: none;
            width: 100%;
            background: transparent;
            margin: 10px 0;
        }
        input[type=range]:focus { outline: none; }
        
        input[type=range]::-webkit-slider-runnable-track {
            width: 100%;
            height: 6px;
            cursor: pointer;
            background: var(--slider-track);
            border-radius: 3px;
        }
        
        input[type=range]::-webkit-slider-thumb {
            height: 22px;
            width: 22px;
            border-radius: 50%;
            background: var(--primary);
            cursor: pointer;
            -webkit-appearance: none;
            margin-top: -8px;
            box-shadow: 0 0 8px rgba(0, 229, 255, 0.4);
            border: 2px solid #fff;
        }

        /* Z-Slider Specific */
        .z-slider::-webkit-slider-thumb { background: var(--accent); box-shadow: 0 0 8px rgba(255, 0, 85, 0.4); }

        /* Submit Button */
        .fab-container {
            position: fixed;
            bottom: 0; left: 0; width: 100%;
            padding: 15px 20px 25px;
            background: linear-gradient(to top, rgba(18,18,18,1) 85%, transparent);
            box-sizing: border-box;
            z-index: 100;
            display: flex;
            gap: 10px;
        }
        
        button {
            border: none;
            border-radius: 30px;
            padding: 14px;
            font-weight: bold;
            font-size: 1rem;
            cursor: pointer;
            flex: 1;
        }

        .submit-btn { background: var(--primary); color: #000; box-shadow: 0 4px 12px rgba(0, 229, 255, 0.3); }
        .reset-btn { background: #333; color: #fff; flex: 0.3; }

        .input-text {
            width: 100%; padding: 10px;
            background: #333; border: 1px solid #444;
            color: white; border-radius: 6px;
            box-sizing: border-box;
        }
    </style>
</head>
<body>

    <h1>CityCure é‡‡é›† v2.0</h1>
    <p class="subtitle">æ»‘åŠ¨ä»¥åŒ¹é…æœ€ç²¾å‡†çš„æè¿° (-3 è‡³ +3)</p>

    <div class="card">
        <div class="card-header">
            <span class="icon">ğŸ“¸</span>
            <span class="card-title">ä½ç½®ä¸å­˜è¯</span>
        </div>
        <div style="margin-bottom: 15px;">
            <input type="text" id="locID" class="input-text" placeholder="è¾“å…¥ç¼–å·">
        </div>
        
        <label class="photo-upload-box" for="cameraInput">
            <span style="font-size:1.5rem">ğŸ“·</span><br>
            <span style="font-size:0.8rem; color:#aaa">ç‚¹å‡»æ‹ç…§æˆ–ä¸Šä¼ å›¾ç‰‡</span>
            <img id="preview" class="photo-preview">
        </label>
        <input type="file" id="cameraInput" accept="image/*" capture="environment" onchange="previewImage(this)">
    </div>

    <div class="card" style="border-top: 3px solid var(--accent);">
        <div class="card-header">
            <span class="icon">ğŸ§ </span>
            <span class="card-title">Zå€¼: ç›´è§‰æ•´ä½“è¯„åˆ†</span>
        </div>
        <div class="q-group">
            <div class="q-label">
                <span>ç›´è§‰æ„Ÿå—</span>
                <span id="val_Z" class="val-display" style="color:var(--accent)">50</span>
            </div>
            <input type="range" min="0" max="100" value="50" class="z-slider" oninput="updateZ(this.value)">
            <div class="desc-text" id="desc_Z">50: æ— åŠŸæ— è¿‡ï¼Œä¸­æ€§</div>
        </div>
    </div>

    <div class="card">
        <div class="card-header"><span class="icon">ğŸŒ¿</span><span class="card-title">S1 è‡ªç„¶æ™¯è§‚</span></div>
        
        <div class="q-group">
            <div class="q-label"><span>ç»¿åŒ–å­˜åœ¨åº¦ (E)</span><span id="val_S1_E" class="val-display">0</span></div>
            <input type="range" min="-3" max="3" step="1" value="0" oninput="updateDesc('S1_E', this.value)">
            <div class="desc-text" id="desc_S1_E">0: ä¸­ç­‰...</div>
        </div>
        <div class="q-group">
            <div class="q-label"><span>ç”Ÿæ€å¥åº·åº¦ (Q)</span><span id="val_S1_Q" class="val-display">0</span></div>
            <input type="range" min="-3" max="3" step="1" value="0" oninput="updateDesc('S1_Q', this.value)">
            <div class="desc-text" id="desc_S1_Q">0: ä¸€èˆ¬...</div>
        </div>
        <div class="q-group">
            <div class="q-label"><span>é™æ¸©æ²»æ„ˆæ„Ÿ (X)</span><span id="val_S1_X" class="val-display">0</span></div>
            <input type="range" min="-3" max="3" step="1" value="0" oninput="updateDesc('S1_X', this.value)">
            <div class="desc-text" id="desc_S1_X">0: æ— æ„Ÿ...</div>
        </div>
    </div>

    <div class="card">
        <div class="card-header"><span class="icon">ğŸ—ï¸</span><span class="card-title">S2 ç©ºé—´ç»“æ„</span></div>
        
        <div class="q-group">
            <div class="q-label"><span>ç•Œé¢æ¸…æ™°åº¦ (E)</span><span id="val_S2_E" class="val-display">0</span></div>
            <input type="range" min="-3" max="3" step="1" value="0" oninput="updateDesc('S2_E', this.value)">
            <div class="desc-text" id="desc_S2_E">0: ä¸­ç­‰...</div>
        </div>
        <div class="q-group">
            <div class="q-label"><span>ç©ºé—´ç§©åºæ„Ÿ (Q)</span><span id="val_S2_Q" class="val-display">0</span></div>
            <input type="range" min="-3" max="3" step="1" value="0" oninput="updateDesc('S2_Q', this.value)">
            <div class="desc-text" id="desc_S2_Q">0: æ•´æ´...</div>
        </div>
        <div class="q-group">
            <div class="q-label"><span>å¼€æ•é€šç•…æ„Ÿ (X)</span><span id="val_S2_X" class="val-display">0</span></div>
            <input type="range" min="-3" max="3" step="1" value="0" oninput="updateDesc('S2_X', this.value)">
            <div class="desc-text" id="desc_S2_X">0: ä¸€èˆ¬...</div>
        </div>
    </div>

    <div class="card">
        <div class="card-header"><span class="icon">ğŸ¨</span><span class="card-title">S3 ç¾å­¦ç‰¹å¾</span></div>
        
        <div class="q-group">
            <div class="q-label"><span>è§†è§‰ä¸°å¯Œåº¦ (E)</span><span id="val_S3_E" class="val-display">0</span></div>
            <input type="range" min="-3" max="3" step="1" value="0" oninput="updateDesc('S3_E', this.value)">
            <div class="desc-text" id="desc_S3_E">0: æ™®é€š...</div>
        </div>
        <div class="q-group">
            <div class="q-label"><span>å·¥è‰ºåè°ƒæ€§ (Q)</span><span id="val_S3_Q" class="val-display">0</span></div>
            <input type="range" min="-3" max="3" step="1" value="0" oninput="updateDesc('S3_Q', this.value)">
            <div class="desc-text" id="desc_S3_Q">0: å¸¸è§„...</div>
        </div>
        <div class="q-group">
            <div class="q-label"><span>è§†è§‰æ„‰æ‚¦æ„Ÿ (X)</span><span id="val_S3_X" class="val-display">0</span></div>
            <input type="range" min="-3" max="3" step="1" value="0" oninput="updateDesc('S3_X', this.value)">
            <div class="desc-text" id="desc_S3_X">0: æ— æ„Ÿ...</div>
        </div>
    </div>

    <div class="card">
        <div class="card-header"><span class="icon">ğŸª‘</span><span class="card-title">S4 ç¤¾ä¼šå¯ä¾›æ€§</span></div>
        
        <div class="q-group">
            <div class="q-label"><span>è®¾æ–½å¯†åº¦ (E)</span><span id="val_S4_E" class="val-display">0</span></div>
            <input type="range" min="-3" max="3" step="1" value="0" oninput="updateDesc('S4_E', this.value)">
            <div class="desc-text" id="desc_S4_E">0: ä¸­ç­‰...</div>
        </div>
        <div class="q-group">
            <div class="q-label"><span>äººä½“å·¥å­¦ (Q)</span><span id="val_S4_Q" class="val-display">0</span></div>
            <input type="range" min="-3" max="3" step="1" value="0" oninput="updateDesc('S4_Q', this.value)">
            <div class="desc-text" id="desc_S4_Q">0: å¯ç”¨...</div>
        </div>
        <div class="q-group">
            <div class="q-label"><span>åœç•™æ„æ„¿ (X)</span><span id="val_S4_X" class="val-display">0</span></div>
            <input type="range" min="-3" max="3" step="1" value="0" oninput="updateDesc('S4_X', this.value)">
            <div class="desc-text" id="desc_S4_X">0: ä¸€èˆ¬...</div>
        </div>
    </div>

    <div class="fab-container">
        <button class="reset-btn" onclick="resetForm()">é‡ç½®</button>
        <button class="submit-btn" onclick="exportData()">å¤åˆ¶æ•°æ®</button>
    </div>

    <script>
        // === æ ¸å¿ƒæ•°æ®å­—å…¸ï¼šå®šä¹‰æ¯ä¸€ä¸ªåˆ†å€¼çš„å…·ä½“å«ä¹‰ ===
        const defs = {
            // --- S1 è‡ªç„¶æ™¯è§‚ ---
            S1_E: {
                "-3": "æåº¦ç¼ºå¤±: è§†é‡å‡ ä¹å…¨æ˜¯ç¡¬è´¨é“ºè£…/å»ºç­‘/å¤©ç©ºï¼Œç»¿è‰²å æ¯”<5%",
                "-2": "ä¸¥é‡ç¼ºä¹: ä»…æœ‰é›¶æ˜Ÿç›†æ ½æˆ–æç»†å°çš„æ ‘ï¼Œç»¿è‰²å æ¯”5-10%",
                "-1": "å°‘: è¡Œé“æ ‘ä¸è¿ç»­æˆ–å† å¹…å¾ˆå°ï¼Œç»¿è‰²å æ¯”10-15%",
                "0": "ä¸­ç­‰: è¿ç»­è¡Œé“æ ‘æˆ–è‰åªï¼Œèƒ½æ„Ÿå—åˆ°ç»¿æ„ï¼Œå æ¯”15-30%",
                "1": "è¾ƒå¤š: æœ‰æˆç‰‡æ ‘è«æˆ–èŠ±å›ï¼Œè§†è§‰èˆ’é€‚ï¼Œå æ¯”30-45%",
                "2": "ä¸°å¯Œ: å¤šå±‚æ¬¡ç»¿åŒ–(ä¹”çŒè‰)ï¼Œæœ‰å¤§æ ‘ï¼Œå æ¯”45-60%",
                "3": "æåº¦ä¸°å¯Œ: æ»¡çœ¼ç»¿è‰²ï¼Œæ ‘å† éƒé—­æˆ–æœ‰å‚ç›´ç»¿åŒ–ï¼Œå æ¯”>60%"
            },
            S1_Q: {
                "-3": "æå·®: æ¤ç‰©æ¯æ­»ã€å¤§é¢ç§¯é»„åœŸè£¸éœ²ã€æ‚è‰ä¸›ç”Ÿ",
                "-2": "å·®: æœ‰æ˜æ˜¾ç—…è™«å®³ï¼Œæå¶æ®‹ç¼ºï¼Œç»´æŠ¤ç¼ºå¤±",
                "-1": "è¾ƒå·®: æ¤ç‰©è™½æ´»ä½†é•¿åŠ¿å¼±ï¼Œçœ‹èµ·æ¥ç°å¤´åœŸè„¸",
                "0": "ä¸€èˆ¬: æ¤ç‰©å¥åº·ä½†ä¿®å‰ªæ™®é€šï¼Œæ— åŠŸæ— è¿‡",
                "1": "è¾ƒå¥½: æ¤ç‰©å¶ç‰‡æœ‰å…‰æ³½ï¼Œæ— æ¯æ",
                "2": "å¥½: ä¿®å‰ªæ•´é½ï¼Œæ­é…ç¾è§‚ï¼Œç”Ÿé•¿æ—ºç››",
                "3": "æå¥½: ç²¾å“å›­è‰ºï¼Œå±‚æ¬¡åˆ†æ˜ï¼Œè‰²å½©é²œè‰³ï¼Œç»´æŠ¤æä½³"
            },
            S1_X: {
                "-3": "æåº¦éš¾å—: æš´æ™’ã€é—·çƒ­ã€æ— é®æŒ¡ï¼Œæƒ³ç«‹åˆ»é€ƒç¦»",
                "-2": "éš¾å—: é˜³å…‰åˆºçœ¼ï¼Œæ„Ÿè§‰ç‡¥çƒ­",
                "-1": "å¾®ä¸é€‚: ç¨æ˜¾é—·çƒ­æˆ–è‡ªç„¶æ°”æ¯ä¸è¶³",
                "0": "æ— æ„Ÿ: ä¸è§‰å¾—çƒ­ï¼Œä¹Ÿæ²¡æœ‰ç‰¹åˆ«æ¸…å‡‰",
                "1": "å¾®èˆ’é€‚: æœ‰æ ‘è«ï¼Œå¶æœ‰å¾®é£",
                "2": "èˆ’é€‚: å‡‰çˆ½ï¼Œç©ºæ°”æ¸…æ–°ï¼Œæ„¿æ„æ·±å‘¼å¸",
                "3": "æåº¦æ²»æ„ˆ: è¢«è‡ªç„¶åŒ…è£¹ï¼Œèº«å¿ƒå½»åº•æ”¾æ¾ï¼Œå®Œå…¨éš”ç»åŸå¸‚å–§åš£"
            },

            // --- S2 ç©ºé—´ç»“æ„ ---
            S2_E: {
                "-3": "æå¼±/è’èŠœ: å·¨å¤§ç©ºæ—·å¹¿åœºæˆ–è’åœ°ï¼Œæ— ä»»ä½•ç©ºé—´è¾¹ç•Œæ„Ÿ",
                "-2": "å¼±: è¡—é“è¿‡å®½ï¼Œå»ºç­‘é€€åæè¿œï¼Œè§†çº¿æ— å¤„ç€è½",
                "-1": "è¾ƒå¼±: ç•Œé¢æ–­ç»­ï¼Œç©ºé—´æ¾æ•£",
                "0": "ä¸­ç­‰: æ­£å¸¸çš„è¡—é“é«˜å®½æ¯”(D/Hâ‰ˆ1)ï¼Œæœ‰æ˜ç¡®ç•Œé¢",
                "1": "è¾ƒå¼º: è¡—é“ç•Œé¢è¿ç»­ï¼Œæœ‰ä¸€å®šå›´åˆæ„Ÿ",
                "2": "å¼º: ç©ºé—´ç´§å‡‘ï¼Œæœ‰è¡Œé“æ ‘æˆ–éª‘æ¥¼å½¢æˆæ˜ç¡®ç©ºé—´æ„Ÿ",
                "3": "æå¼º/åŒ…è£¹: çª„å··ã€è¿å»Šæˆ–èŒ‚å¯†æ ‘å† å½¢æˆçš„å¼ºçƒˆåŒ…è£¹ç©ºé—´"
            },
            S2_Q: {
                "-3": "æåº¦æ··ä¹±: è¿ç« æ­å»ºã€åƒåœ¾å †ç§¯ã€äººè½¦ä¸¥é‡æ··è¡Œ",
                "-2": "æ··ä¹±: ç”µåŠ¨è½¦ä¹±åœå é“ï¼Œè®¾æ–½ç ´æŸä¸¥é‡",
                "-1": "è¾ƒä¹±: åœ°é¢æœ‰æ±¡æ¸æˆ–ç ´æŸï¼Œå¶å°”æœ‰éšœç¢ç‰©",
                "0": "ä¸€èˆ¬: é“è·¯å¹³æ•´ï¼ŒåŸºæœ¬æ•´æ´ï¼Œæ— æ˜æ˜¾è®¾è®¡",
                "1": "è¾ƒå¥½: é“ºè£…å®Œå¥½ï¼Œæœ‰äººè½¦åˆ†æµæªæ–½",
                "2": "æœ‰åº: é“ºè£…ç²¾è‡´ï¼Œè¡—é“å®¶å…·æ’åˆ—æ•´é½",
                "3": "æåº¦æœ‰åº: å›½é™…çº§è¡—é“è®¾è®¡ï¼Œå¯¼è§†æ¸…æ™°ï¼Œæ— ä»»ä½•è§†è§‰å¹²æ‰°"
            },
            S2_X: {
                "-3": "æåº¦å‹æŠ‘/æ‹¥å µ: å¯¸æ­¥éš¾è¡Œï¼Œæˆ–è¢«é«˜æ¥¼å‹è¿«æ„Ÿæå¼º",
                "-2": "å‹æŠ‘: éœ€è¦é¢‘ç¹é¿è®©éšœç¢ç‰©ï¼Œæˆ–æ„Ÿåˆ°å±€ä¿ƒ",
                "-1": "å¾®ä¸é€‚: è¡Œèµ°ä¸å¤Ÿé¡ºç•…",
                "0": "ä¸€èˆ¬: æ­£å¸¸é€šè¡Œï¼Œæ— ç‰¹æ®Šæ„Ÿå—",
                "1": "å¾®é¡ºç•…: è§†é‡å¼€é˜”ï¼Œè·¯é¢å¥½èµ°",
                "2": "é¡ºç•…: ç©ºé—´å°ºåº¦å®œäººï¼Œæ­¥ä¼è½»å¿«",
                "3": "æåº¦æµç•…/å¼€é˜”: ç©ºé—´æµåŠ¨æ„Ÿæä½³ï¼Œè¡Œéšæ„åŠ¨"
            },

            // --- S3 ç¾å­¦ç‰¹å¾ ---
            S3_E: {
                "-3": "æåº¦è´«ä¹: åªæœ‰å¤§ç™½å¢™ã€æ°´æ³¥åœ°ï¼Œæ— ä»»ä½•è‰²å½©/è£…é¥°",
                "-2": "è´«ä¹: ç¼ºä¹å˜åŒ–ï¼Œè§†è§‰å•è°ƒæ¯ç‡¥",
                "-1": "è¾ƒå°‘: åªæœ‰åŠŸèƒ½æ€§è®¾æ–½(è·¯ç¯/æ æ†)",
                "0": "ä¸­ç­‰: æ™®é€šåº—æ‹›ã€å¸¸è§„åŸå¸‚è‰²å½©",
                "1": "ä¸°å¯Œ: æœ‰ç‰¹è‰²æ©±çª—ã€éœ“è™¹ç¯æˆ–è£…é¥°ç«‹é¢",
                "2": "å¼ºçƒˆ: æœ‰è‰ºæœ¯è£…ç½®ã€å£ç”»æˆ–å¤æ‚å»ºç­‘çº¹ç†",
                "3": "æåº¦å¼ºçƒˆ: è§†è§‰ä¿¡æ¯çˆ†ç‚¸ï¼Œå……æ»¡è‰ºæœ¯ç»†èŠ‚æˆ–å¼ºçƒˆè‰²å½©å†²å‡»"
            },
            S3_Q: {
                "-3": "æåº¦å»‰ä»·/å†²çª: æè´¨ä½åŠ£(å¡‘æ–™/å–·ç»˜)ï¼Œé…è‰²æåº¦åˆºçœ¼/åœŸæ°”",
                "-2": "å»‰ä»·: æ‰æ¼†ã€ç”Ÿé”ˆã€æ±¡æŸæ˜æ˜¾",
                "-1": "è¾ƒå·®: é£æ ¼ä¸ç»Ÿä¸€ï¼Œç•¥æ˜¾æ‚ä¹±",
                "0": "å¸¸è§„: æè´¨å®Œå¥½ï¼Œè®¾è®¡å¹³åº¸ï¼Œæ— åŠŸæ— è¿‡",
                "1": "è¾ƒå¥½: æè´¨æœ‰è´¨æ„Ÿï¼Œé…è‰²å’Œè°",
                "2": "ç²¾è‡´: ä½¿ç”¨çŸ³æ/åŸæœ¨ç­‰é«˜çº§ææ–™ï¼Œåšå·¥ç²¾ç»†",
                "3": "æåº¦ç²¾è‡´/è‰ºæœ¯: è‰ºæœ¯å“çº§å·¥è‰ºï¼Œé£æ ¼é«˜åº¦ç»Ÿä¸€ï¼Œæå…·ç¾æ„Ÿ"
            },
            S3_X: {
                "-3": "æåº¦ä¸‘é™‹: è§†è§‰æ±¡æŸ“ä¸¥é‡ï¼Œçœ‹ç€å¤´æ™•/å¿ƒçƒ¦",
                "-2": "ä¸‘é™‹: æ‚ä¹±æ— ç« ï¼Œæƒ³ç§»å¼€è§†çº¿",
                "-1": "å¾®ä¸é€‚: çœ‹ç€ä¸é¡ºçœ¼",
                "0": "æ— æ„Ÿ: çœ‹äº†å°±å¿˜ï¼Œæ— å¿ƒç†æ³¢æ¾œ",
                "1": "å¾®æ„‰æ‚¦: çœ‹ç€æ•´æ´èˆ’é€‚",
                "2": "æ„‰æ‚¦: æœ‰å¸å¼•çœ¼çƒçš„äº®ç‚¹ï¼Œæ„¿æ„å¤šçœ‹ä¸¤çœ¼",
                "3": "æåº¦æ„‰æ‚¦: è§†è§‰ç››å®´ï¼Œå……æ»¡æƒŠå–œï¼Œæƒ³æ‹ç…§ç•™å¿µ"
            },

            // --- S4 ç¤¾ä¼šå¯ä¾›æ€§ ---
            S4_E: {
                "-3": "å®Œå…¨æ’æ–¥: åªæœ‰è½¦é“ï¼Œæˆ–å®‰è£…é˜²åé’‰/æ æ†ï¼Œç¦æ­¢åœç•™",
                "-2": "ä¸¥é‡ç¼ºä¹: ä»…ä½œä¸ºè¿‡é“ï¼Œæ²¡æœ‰ä»»ä½•è®¾æ–½",
                "-1": "å°‘: å¶å°”æœ‰æ æ†æˆ–å°é˜¶å¯ä»¥å‹‰å¼ºé ä¸€ä¸‹",
                "0": "ä¸­ç­‰: æœ‰é›¶æ˜ŸçŸ³å¢©ã€èŠ±å›è¾¹ç¼˜å¯ä»¥å",
                "1": "è¾ƒå¤š: æ²¿é€”æœ‰å‡ å¼ é•¿æ¤…æˆ–è·¯è¾¹æ‘Šä½",
                "2": "ä¸°å¯Œ: æœ‰è¿ç»­çš„ä¼‘æ¯åŒºã€å¤–æ‘†åº§æ¤…",
                "3": "æåº¦ä¸°å¯Œ: ä¸“é—¨çš„æ´»åŠ¨å¹¿åœºã€æ¸¸ä¹è®¾æ–½ï¼Œé¼“åŠ±å„ç§æ´»åŠ¨"
            },
            S4_Q: {
                "-3": "å®Œå…¨ä¸å¯ç”¨: æ¤…å­åœ¨åƒåœ¾æ¡¶æ—/ç§¯æ°´/æ–­è£‚/æè„",
                "-2": "éš¾ç”¨: æ²¡æœ‰ä»»ä½•é®è”½ï¼Œæš´æ™’æˆ–æ·‹é›¨ï¼Œæè´¨å†°å†·",
                "-1": "å‹‰å¼ºå¯ç”¨: å°ºå¯¸ä¸åˆç†(å¤ªé«˜/å¤ªä½/å¤ªçª„)",
                "0": "å¯ç”¨: æ™®é€šçŸ³å‡³/æœ¨æ¤…ï¼Œæ— é èƒŒï¼Œèƒ½åä½†ä¸ä¹…",
                "1": "è¾ƒå¥½: ä½ç½®åˆç†ï¼Œç›¸å¯¹å¹²å‡€",
                "2": "èˆ’é€‚: æœ‰é èƒŒæ‰¶æ‰‹ï¼Œæè´¨èˆ’é€‚ï¼Œæœå‘é£æ™¯",
                "3": "æåº¦èˆ’é€‚: äººä½“å·¥å­¦è®¾è®¡ï¼Œå†¬æš–å¤å‡‰ï¼Œç»´æŠ¤æåº¦å¹²å‡€"
            },
            S4_X: {
                "-3": "æåº¦ä¸å®‰/å°´å°¬: æ„Ÿè§‰æœ‰äººç›‘è§†ï¼Œæˆ–è½¦æµè´´èº«è€Œè¿‡ï¼Œæä¸å®‰å…¨",
                "-2": "æƒ³ç¦»å¼€: æ°›å›´å†·æ¼ æˆ–å˜ˆæ‚ï¼Œä¸æƒ³å¤šå¾…",
                "-1": "å¾®å°´å°¬: åœç•™æ˜¾å¾—çªå…€",
                "0": "ä¸€èˆ¬: ä¸æ’æ–¥åœç•™ï¼Œä½†ä¹Ÿæ²¡ç†ç”±å¾…ç€",
                "1": "å¾®å®‰é€‚: å¯ä»¥åœ¨è¿™é‡Œå›ä¸ªæ¶ˆæ¯",
                "2": "å®‰é€‚: æ„¿æ„åä¸‹æ¥å–æ¯å’–å•¡æˆ–å‘å‘†",
                "3": "æåº¦å½’å±æ„Ÿ: åƒè‡ªå®¶å®¢å…ä¸€æ ·è‡ªåœ¨ï¼Œå……æ»¡äººæƒ…å‘³"
            }
        };

        // åˆå§‹åŒ–
        window.onload = function() {
            // åˆå§‹åŒ–æ‰€æœ‰æè¿°
            Object.keys(defs).forEach(key => updateDesc(key, 0));
        };

        // æ›´æ–°Zå€¼
        function updateZ(val) {
            document.getElementById("val_Z").innerText = val;
            let text = val < 40 ? "ä»¤äººå‹æŠ‘" : (val < 70 ? "ä¸­æ€§æ— æ„Ÿ" : "ä»¤äººæ²»æ„ˆ");
            document.getElementById("desc_Z").innerText = `${val}: ${text}`;
        }

        // æ›´æ–°é€šç”¨æè¿°
        function updateDesc(key, val) {
            // æ˜¾ç¤ºæ•°å­— + å·
            let displayVal = val > 0 ? "+" + val : val;
            document.getElementById("val_" + key).innerText = displayVal;
            
            // æŸ¥æ‰¾å®šä¹‰
            let text = defs[key][val] || "æœªçŸ¥æè¿°";
            
            // UIåé¦ˆ
            let descEl = document.getElementById("desc_" + key);
            descEl.innerText = text;
            descEl.classList.add("highlight");
            
            // ç§»é™¤é«˜äº®åŠ¨ç”»
            clearTimeout(descEl.timer);
            descEl.timer = setTimeout(() => descEl.classList.remove("highlight"), 300);
        }

        // å›¾ç‰‡é¢„è§ˆåŠŸèƒ½
        function previewImage(input) {
            if (input.files && input.files[0]) {
                var reader = new FileReader();
                reader.onload = function(e) {
                    var img = document.getElementById('preview');
                    img.src = e.target.result;
                    img.style.display = 'block';
                }
                reader.readAsDataURL(input.files[0]);
            }
        }

        // å¯¼å‡ºæ•°æ®
        function exportData() {
            let loc = document.getElementById("locID").value || "æœªå‘½åç‚¹ä½";
            let z = document.getElementById("val_Z").innerText;
            
            // æ”¶é›†æ‰€æœ‰ slider çš„å€¼ (é¡ºåº: S1E, S1Q, S1X, S2E...)
            let values = [];
            // æŒ‰ç…§é¡µé¢é¡ºåºè·å–æ‰€æœ‰éZå€¼çš„slider
            const keys = ["S1_E", "S1_Q", "S1_X", "S2_E", "S2_Q", "S2_X", "S3_E", "S3_Q", "S3_X", "S4_E", "S4_Q", "S4_X"];
            keys.forEach(k => {
                let val = document.getElementById("val_" + k).innerText;
                values.push(val); // ä¿ç•™ç¬¦å·ï¼Œå¦‚ +1
            });

            // è·å–å›¾ç‰‡å (æ¨¡æ‹Ÿ)
            let imgInput = document.getElementById('cameraInput');
            let imgName = imgInput.files.length > 0 ? "æœ‰å›¾ç‰‡" : "æ— å›¾ç‰‡";

            let csvLine = `${loc},${z},${values.join(',')},${imgName}`;
            
            navigator.clipboard.writeText(csvLine).then(() => {
                alert(`âœ… æ•°æ®å·²å¤åˆ¶!\n\n${csvLine}\n\nè¯·ç²˜è´´åˆ°Excelã€‚`);
            }).catch(() => {
                alert(`âŒ å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨è®°å½•:\n${csvLine}`);
            });
        }

        // é‡ç½®è¡¨å•
        function resetForm() {
            if(confirm("ç¡®å®šè¦é‡ç½®æ‰€æœ‰é€‰é¡¹å—ï¼Ÿ")) {
                document.querySelectorAll('input[type=range]').forEach(i => {
                    i.value = (i.className === 'z-slider') ? 50 : 0;
                    i.oninput(); // è§¦å‘æ›´æ–°æ–‡å­—
                });
                document.getElementById('locID').value = "";
                document.getElementById('preview').style.display = 'none';
                document.getElementById('cameraInput').value = "";
                window.scrollTo(0,0);
            }
        }
    </script>
</body>
</html>